# Default Repository Rulesets
# Define reusable rulesets that can be applied to config groups or individual repositories
#
# Supported rule types:
# - deletion: Prevent branch/tag deletion
# - non_fast_forward: Prevent force pushes
# - required_linear_history: Require linear history
# - required_signatures: Require signed commits
# - pull_request: Require pull request reviews
# - required_status_checks: Require CI checks to pass
# - creation: Control branch creation
# - update: Control branch updates
# - commit_message_pattern: Enforce commit message patterns
# - branch_name_pattern: Enforce branch naming patterns

# Main branch protection for open source repositories
oss-main-protection:
  target: branch
  enforcement: active
  conditions:
    ref_name:
      include:
        - "~DEFAULT_BRANCH"
      exclude: []
  rules:
    - type: deletion
    - type: non_fast_forward
    - type: required_linear_history
    - type: pull_request
      parameters:
        required_approving_review_count: 1
        dismiss_stale_reviews_on_push: true
        require_code_owner_review: false
        require_last_push_approval: false

# Main branch protection for internal repositories
# Requires paid GitHub plan for private repositories
internal-main-protection:
  target: branch
  enforcement: active
  conditions:
    ref_name:
      include:
        - "~DEFAULT_BRANCH"
      exclude: []
  rules:
    - type: deletion
    - type: non_fast_forward
    - type: required_linear_history

# Release branch protection (example)
release-branch-protection:
  target: branch
  enforcement: active
  conditions:
    ref_name:
      include:
        - "refs/heads/release/*"
        - "refs/heads/v*"
      exclude: []
  rules:
    - type: deletion
    - type: non_fast_forward
    - type: required_linear_history
    - type: pull_request
      parameters:
        required_approving_review_count: 2
        dismiss_stale_reviews_on_push: true
        require_code_owner_review: true
        require_last_push_approval: true

# Tag protection (example)
tag-protection:
  target: tag
  enforcement: active
  conditions:
    ref_name:
      include:
        - "refs/tags/v*"
      exclude: []
  rules:
    - type: deletion
    - type: update
